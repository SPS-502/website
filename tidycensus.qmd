---
title: "Using tidycensus"
sidebar: false
toc: true
page-layout: full
format: html
---

This is adapted from the "Basic usage of tidycensus" page, which can be found [here](https://walker-data.com/tidycensus/articles/basic-usage.html). 

# Setup

You'll need to install, load, and configure the `tidycensus` package. BUT it's not that hard!

## Step 1: Install

Run the following code:

```{r}
install.packages("tidycensus")
```

## Step 2: Load and configure

- Next, you'll need to get an API key from the U.S. Census Bureau. Follow this [link](https://api.census.gov/data/key_signup.html), enter your information and you should get an email with your API key shortly.

- Next, add your api key and run the following code:

```{r}
library(tidycensus)
library(tidyverse)

census_api_key("YOUR API KEY GOES HERE", install = TRUE)
```


## Step 3: Find variables
Next you'll want to get the variables you'd like to use in your project. There are a TON of variables you can get through `tidycensus`. So the best way to start is to use the `load_variables()` function to get a searchable table of all the variables you can use. In this case, we'll call up the 2020 American Community Survey and store the results in an object called `tidycensusvariables`. We can then browse and search with the `View()` function (see video for demonstration of this part). 

```{r}
tidycensusvariables <- load_variables(year = 2020, dataset = "acs5") 

#Run View(tidycensusvariables) in your console
```


```{r}
	id2 <- get_acs(
  geography = "county",
  state = "Idaho",
  variables = c(edu_attainment = "B15001_001"),
  year = 2020
)


```


```{r}
vars <- load_variables(2017, "acs5", cache = TRUE) %>%
mutate(table_id = str_sub(name, 1, 6),
# Race generally is in parentheses after the concept name.
# But for a few cases, something else is in parentheses first. So I
# am going to blank out that stuff and then assume whatever I find inside
# of parentheses is race.
concept = str_replace_all(concept,
c("\\(IN 2017 INFLATION-ADJUSTED DOLLARS\\)" = "",
"\\(EXCLUDING HOUSEHOLDERS, SPOUSES, AND UNMARRIED PARTNERS\\)" = "",
"\\(SSI\\)" = "",
"\\(INCLUDING LIVING ALONE\\)" = "",
"\\(IN MINUTES\\)" = "",
"\\(DOLLARS\\)" = "",
"\\(CT, ME, MA, MI, MN, NH, NJ, NY, PA, RI, VT, WI\\)" = "--CT, ME, MA, MI, MN, NH, NJ, NY, PA, RI, VT, WI--",
"\\(CAR, TRUCK, OR VAN\\)" = "--CAR, TRUCK, OR VAN--",
"\\(\\)" = ""
)),
race = str_extract(concept, "\\(.+\\)"),
race = str_replace(race, "\\(", ""),
race = str_replace(race, "\\)", ""))
```


Search the dataframe for variables you think you'd like to use and make a list. Here's my list:

B15003_022 - Educational Attainment (age 25+ with at least a bachelor's degree)
	
B29003_001 - Voting age citizens in poverty

median_income = "B19013_001",
                median_age = "B01002_001",
                total_population = "B01003_001",
                pct_college = "DP02_0068P",
                median_value = "B25077_001")



